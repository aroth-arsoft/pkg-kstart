# Makefile for kstart
# $Id$

srcdir		= @srcdir@
VPATH		= @srcdir@

prefix		= @prefix@
exec_prefix	= @exec_prefix@

bindir		= @bindir@
mandir		= @mandir@

CC		= @CC@
CFLAGS		= @CFLAGS@
CPPFLAGS	= -I. -I$(srcdir) @CPPFLAGS@
LDFLAGS		= @LDFLAGS@
LIBS		= @LIBS@
KRBLIBS		= @KRBLIBS@ $(LIBS)
KRB5LIBS	= @KRB5LIBS@ $(LIBS)

INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@

##############################################################################

SOURCE_FILES	= k5start.c kstart.c

EXTRA_FILES	= Makefile.in VERSION config.h.in configure configure.in \
		  install-sh k5start.pod k5start.1 kstart.pod kstart.1

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

all: kstart k5start kstart.1 k5start.1

install: kstart k5start kstart.1 k5start.1
	$(INSTALL_PROGRAM) kstart $(bindir)/kstart
	$(INSTALL_PROGRAM) k5start $(bindir)/k5start
	$(INSTALL_DATA) $(srcdir)/kstart.1 $(mandir)/man1/kstart.1
	$(INSTALL_DATA) $(srcdir)/k5start.1 $(mandir)/man1/k5start.1

kstart: kstart.o 
	$(CC) $(LDFLAGS) -o kstart kstart.o $(KRBLIBS)

k5start: k5start.o
	$(CC) $(LDFLAGS) -o k5start k5start.o $(KRB5LIBS)

kstart.1: kstart.pod
	pod2man --release=`awk '/Id: / { print $$3; exit }' $(srcdir)/kstart.c` \
	    --center="User commands" $< > $@

k5start.1: k5start.pod
	pod2man --release=`awk '/Id: / { print $$3; exit }' $(srcdir)/k5start.c` \
	    --center="User commands" $< > $@

clean:
	rm -f *.o kstart k5start

distclean: clean
	rm -f Makefile config.cache config.h config.log config.status kstart-*

maintclean: distclean
	rm -f config.h.in configure kstart.1 k5start.1

dist: $(SOURCE_FILES) $(EXTRA_FILES)
	mkdir kstart-`cat VERSION`
	cp $(SOURCE_FILES) kstart-`cat VERSION`
	cp $(EXTRA_FILES) kstart-`cat VERSION`
	tar cf kstart-`cat VERSION`.tar kstart-`cat VERSION`
	gzip -9 kstart-`cat VERSION`.tar
	rm -rf kstart-`cat VERSION`
