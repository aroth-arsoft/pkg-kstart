# Makefile for kstart
# $Id$

srcdir		= @srcdir@
VPATH		= @srcdir@

PACKAGE		= @PACKAGE_TARNAME@
VERSION		= @PACKAGE_VERSION@
TARDIR		= $(PACKAGE)-$(VERSION)
DEBNAME		= $(PACKAGE)_$(VERSION)
TARNAME		= $(TARDIR).tar

prefix		= @prefix@
exec_prefix	= @exec_prefix@

bindir		= @bindir@
mandir		= @mandir@

CC		= @CC@
CFLAGS		= @CFLAGS@
CPPFLAGS	= -I. -I$(srcdir) @CPPFLAGS@
LDFLAGS		= @LDFLAGS@
LIBS		= @LIBS@
LIBOBJS		= @LIBOBJS@
KRBLIBS		= @KRBLIBS@ $(LIBS)
KRB5LIBS	= @KRB5LIBS@ $(LIBS)

INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

all: kstart k5start kstart.1 k5start.1

install: kstart k5start kstart.1 k5start.1
	$(INSTALL) -d $(bindir) $(mandir)/man1
	$(INSTALL_PROGRAM) kstart $(bindir)/kstart
	$(INSTALL_PROGRAM) k5start $(bindir)/k5start
	$(INSTALL_DATA) kstart.1 $(mandir)/man1/kstart.1
	$(INSTALL_DATA) k5start.1 $(mandir)/man1/k5start.1

kstart: kstart.o $(LIBOBJS)
	$(CC) $(LDFLAGS) -o kstart kstart.o $(LIBOBJS) $(KRBLIBS)

k5start: k5start.o
	$(CC) $(LDFLAGS) -o k5start k5start.o $(KRB5LIBS)

kstart.1: kstart.pod
	pod2man --release=$(VERSION) --center="User commands" $< > $@

k5start.1: k5start.pod
	pod2man --release=$(VERSION) --center="User commands" $< > $@

clean:
	rm -f *.o kstart k5start

distclean: clean
	rm -f Makefile config.cache config.h config.log config.status kstart-*
	rm -rf autom4te.cache

maintclean: distclean
	rm -f config.h.in configure kstart.1 k5start.1

dist:
	rm -rf $(TARNAME).gz $(TARNAME).gz.md5 $(TARDIR)
	mkdir $(TARDIR)
	rsync -C -a ./ $(TARDIR)/
	rsync -a kstart.1 k5start.1 $(TARDIR)/
	cd $(TARDIR) && autoconf && autoheader && rm -rf autom4te.cache
	tar cf $(TARNAME) $(TARDIR)
	gzip -9 $(TARNAME)
	md5sum $(TARNAME).gz > $(TARNAME).gz.md5

# Prepare to make a Debian package.  This doesn't do the actual work of
# creating the package; there are too many different flags we might want to
# use.  It just copies things around so that the Debian packaging will work
# properly.
deb-prep: dist
	rm -f *.orig.tar.gz $(DEBNAME)* *_$(VERSION)-*.deb
	cp $(TARNAME).gz $(PACKAGE)_$(VERSION).orig.tar.gz
